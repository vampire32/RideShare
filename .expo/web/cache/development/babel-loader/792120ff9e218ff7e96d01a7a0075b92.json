{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nvar _excluded = [\"firebaseConfig\", \"firebaseVersion\", \"appVerificationDisabledForTesting\", \"languageCode\", \"onVerify\", \"onLoad\", \"onError\", \"onFullChallenge\", \"invisible\", \"verify\"];\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nimport { DEFAULT_WEB_APP_OPTIONS } from 'expo-firebase-core';\nimport { CodedError } from 'expo-modules-core';\nimport * as React from 'react';\nimport { WebView } from \"./WebView\";\nfunction getWebviewSource(firebaseConfig, firebaseVersion) {\n  var appVerificationDisabledForTesting = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var languageCode = arguments.length > 3 ? arguments[3] : undefined;\n  var invisible = arguments.length > 4 ? arguments[4] : undefined;\n  firebaseVersion = firebaseVersion || '8.0.0';\n  return {\n    baseUrl: \"https://\" + firebaseConfig.authDomain,\n    html: \"\\n<!DOCTYPE html><html>\\n<head>\\n  <meta name=\\\"viewport\\\" content=\\\"width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no\\\">\\n  <meta http-equiv=\\\"X-UA-Compatible\\\" content=\\\"IE=edge,chrome=1\\\">\\n  <meta name=\\\"HandheldFriendly\\\" content=\\\"true\\\">\\n  <script src=\\\"https://www.gstatic.com/firebasejs/\" + firebaseVersion + \"/firebase-app.js\\\"></script>\\n  <script src=\\\"https://www.gstatic.com/firebasejs/\" + firebaseVersion + \"/firebase-auth.js\\\"></script>\\n  <script type=\\\"text/javascript\\\">firebase.initializeApp(\" + JSON.stringify(firebaseConfig) + \");</script>\\n  <style>\\n    html, body {\\n      height: 100%;\\n      \" + (invisible ? \"padding: 0; margin: 0;\" : \"\") + \"\\n    }\\n    #recaptcha-btn {\\n      width: 100%;\\n      height: 100%;\\n      padding: 0;\\n      margin: 0;\\n      border: 0;\\n      user-select: none;\\n      -webkit-user-select: none;\\n    }\\n  </style>\\n</head>\\n<body>\\n  \" + (invisible ? \"<button id=\\\"recaptcha-btn\\\" type=\\\"button\\\" onclick=\\\"onClickButton()\\\">Confirm reCAPTCHA</button>\" : \"<div id=\\\"recaptcha-cont\\\" class=\\\"g-recaptcha\\\"></div>\") + \"\\n  <script>\\n    var fullChallengeTimer;\\n    function onVerify(token) {\\n      if (fullChallengeTimer) {\\n        clearInterval(fullChallengeTimer);\\n        fullChallengeTimer = undefined;\\n      }\\n      window.ReactNativeWebView.postMessage(JSON.stringify({\\n        type: 'verify',\\n        token: token\\n      }));\\n    }\\n    function onLoad() {\\n      window.ReactNativeWebView.postMessage(JSON.stringify({\\n        type: 'load'\\n      }));\\n      firebase.auth().settings.appVerificationDisabledForTesting = \" + appVerificationDisabledForTesting + \";\\n      \" + (languageCode ? \"firebase.auth().languageCode = '\" + languageCode + \"';\" : '') + \"\\n      window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier(\\\"\" + (invisible ? 'recaptcha-btn' : 'recaptcha-cont') + \"\\\", {\\n        size: \\\"\" + (invisible ? 'invisible' : 'normal') + \"\\\",\\n        callback: onVerify\\n      });\\n      window.recaptchaVerifier.render();\\n    }\\n    function onError() {\\n      window.ReactNativeWebView.postMessage(JSON.stringify({\\n        type: 'error'\\n      }));\\n    }\\n    function onClickButton() {\\n      if (!fullChallengeTimer) {\\n        fullChallengeTimer = setInterval(function() {\\n          var iframes = document.getElementsByTagName(\\\"iframe\\\");\\n          var isFullChallenge = false;\\n          for (i = 0; i < iframes.length; i++) {\\n            var parentWindow = iframes[i].parentNode ? iframes[i].parentNode.parentNode : undefined;\\n            var isHidden = parentWindow && parentWindow.style.opacity == 0;\\n            isFullChallenge = isFullChallenge || (\\n              !isHidden && \\n              ((iframes[i].title === 'recaptcha challenge') ||\\n               (iframes[i].src.indexOf('google.com/recaptcha/api2/bframe') >= 0)));\\n          }\\n          if (isFullChallenge) {\\n            clearInterval(fullChallengeTimer);\\n            fullChallengeTimer = undefined;\\n            window.ReactNativeWebView.postMessage(JSON.stringify({\\n              type: 'fullChallenge'\\n            }));  \\n          }\\n        }, 100);\\n      }\\n    }\\n    window.addEventListener('message', function(event) {\\n      if (event.data.verify) {\\n        document.getElementById('recaptcha-btn').click();\\n      }\\n    });\\n  </script>\\n  <script src=\\\"https://www.google.com/recaptcha/api.js?onload=onLoad&render=explicit&hl=\" + (languageCode != null ? languageCode : '') + \"\\\" onerror=\\\"onError()\\\"></script>\\n</body></html>\"\n  };\n}\nfunction validateFirebaseConfig(firebaseConfig) {\n  if (!firebaseConfig) {\n    throw new CodedError('ERR_FIREBASE_RECAPTCHA_CONFIG', \"Missing firebase web configuration. Please set the \\\"expo.web.config.firebase\\\" field in \\\"app.json\\\" or use the \\\"firebaseConfig\\\" prop.\");\n  }\n  var authDomain = firebaseConfig.authDomain;\n  if (!authDomain) {\n    throw new CodedError('ERR_FIREBASE_RECAPTCHA_CONFIG', \"Missing \\\"authDomain\\\" in firebase web configuration.\");\n  }\n}\nexport default function FirebaseRecaptcha(props) {\n  var firebaseConfig = props.firebaseConfig,\n    firebaseVersion = props.firebaseVersion,\n    appVerificationDisabledForTesting = props.appVerificationDisabledForTesting,\n    languageCode = props.languageCode,\n    onVerify = props.onVerify,\n    onLoad = props.onLoad,\n    onError = props.onError,\n    onFullChallenge = props.onFullChallenge,\n    invisible = props.invisible,\n    verify = props.verify,\n    otherProps = _objectWithoutProperties(props, _excluded);\n  var webview = React.useRef(null);\n  var _React$useState = React.useState(false),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    loaded = _React$useState2[0],\n    setLoaded = _React$useState2[1];\n  React.useEffect(function () {\n    if (webview.current && loaded && verify) {\n      webview.current.injectJavaScript(\"\\n    (function(){\\n      window.dispatchEvent(new MessageEvent('message', {data: { verify: true }}));\\n    })();\\n    true;\\n    \");\n    }\n    return function () {};\n  }, [webview, verify, loaded]);\n  validateFirebaseConfig(firebaseConfig);\n  if (!firebaseConfig) {\n    console.error(\"FirebaseRecaptcha: Missing firebase web configuration. Please set the \\\"expo.web.config.firebase\\\" field in \\\"app.json\\\" or use the \\\"firebaseConfig\\\" prop.\");\n    return null;\n  }\n  return React.createElement(WebView, _objectSpread({\n    ref: webview,\n    javaScriptEnabled: true,\n    automaticallyAdjustContentInsets: true,\n    scalesPageToFit: true,\n    mixedContentMode: \"always\",\n    source: getWebviewSource(firebaseConfig, firebaseVersion, appVerificationDisabledForTesting, languageCode, invisible),\n    onError: onError,\n    onMessage: function onMessage(event) {\n      var data = JSON.parse(event.nativeEvent.data);\n      switch (data.type) {\n        case 'load':\n          if (onLoad) {\n            setLoaded(true);\n            onLoad();\n          }\n          break;\n        case 'error':\n          if (onError) {\n            onError();\n          }\n          break;\n        case 'verify':\n          onVerify(data.token);\n          break;\n        case 'fullChallenge':\n          if (onFullChallenge) {\n            onFullChallenge();\n          }\n          break;\n      }\n    }\n  }, otherProps));\n}\nFirebaseRecaptcha.defaultProps = {\n  firebaseConfig: DEFAULT_WEB_APP_OPTIONS\n};","map":{"version":3,"mappings":"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","names":["DEFAULT_WEB_APP_OPTIONS","CodedError","React","WebView","getWebviewSource","firebaseConfig","firebaseVersion","appVerificationDisabledForTesting","languageCode","invisible","baseUrl","authDomain","html","JSON","stringify","validateFirebaseConfig","FirebaseRecaptcha","props","onVerify","onLoad","onError","onFullChallenge","verify","otherProps","webview","useRef","useState","loaded","setLoaded","useEffect","current","injectJavaScript","console","error","ref","javaScriptEnabled","automaticallyAdjustContentInsets","scalesPageToFit","mixedContentMode","source","onMessage","event","data","parse","nativeEvent","type","token","defaultProps"],"sourceRoot":"","sources":["../src/FirebaseRecaptcha.tsx"],"sourcesContent":["import { DEFAULT_WEB_APP_OPTIONS, FirebaseOptions } from 'expo-firebase-core';\nimport { CodedError } from 'expo-modules-core';\nimport * as React from 'react';\n\nimport { WebView } from './WebView';\n\ninterface Props extends React.ComponentProps<typeof WebView> {\n  firebaseConfig?: FirebaseOptions;\n  firebaseVersion?: string;\n  appVerificationDisabledForTesting?: boolean;\n  languageCode?: string;\n  onLoad?: () => any;\n  onError?: () => any;\n  onVerify: (token: string) => any;\n  onFullChallenge?: () => any;\n  invisible?: boolean;\n  verify?: boolean;\n}\n\nfunction getWebviewSource(\n  firebaseConfig: FirebaseOptions,\n  firebaseVersion?: string,\n  appVerificationDisabledForTesting: boolean = false,\n  languageCode?: string,\n  invisible?: boolean\n) {\n  firebaseVersion = firebaseVersion || '8.0.0';\n  return {\n    baseUrl: `https://${firebaseConfig.authDomain}`,\n    html: `\n<!DOCTYPE html><html>\n<head>\n  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\">\n  <meta name=\"HandheldFriendly\" content=\"true\">\n  <script src=\"https://www.gstatic.com/firebasejs/${firebaseVersion}/firebase-app.js\"></script>\n  <script src=\"https://www.gstatic.com/firebasejs/${firebaseVersion}/firebase-auth.js\"></script>\n  <script type=\"text/javascript\">firebase.initializeApp(${JSON.stringify(firebaseConfig)});</script>\n  <style>\n    html, body {\n      height: 100%;\n      ${invisible ? `padding: 0; margin: 0;` : ``}\n    }\n    #recaptcha-btn {\n      width: 100%;\n      height: 100%;\n      padding: 0;\n      margin: 0;\n      border: 0;\n      user-select: none;\n      -webkit-user-select: none;\n    }\n  </style>\n</head>\n<body>\n  ${\n    invisible\n      ? `<button id=\"recaptcha-btn\" type=\"button\" onclick=\"onClickButton()\">Confirm reCAPTCHA</button>`\n      : `<div id=\"recaptcha-cont\" class=\"g-recaptcha\"></div>`\n  }\n  <script>\n    var fullChallengeTimer;\n    function onVerify(token) {\n      if (fullChallengeTimer) {\n        clearInterval(fullChallengeTimer);\n        fullChallengeTimer = undefined;\n      }\n      window.ReactNativeWebView.postMessage(JSON.stringify({\n        type: 'verify',\n        token: token\n      }));\n    }\n    function onLoad() {\n      window.ReactNativeWebView.postMessage(JSON.stringify({\n        type: 'load'\n      }));\n      firebase.auth().settings.appVerificationDisabledForTesting = ${appVerificationDisabledForTesting};\n      ${languageCode ? `firebase.auth().languageCode = '${languageCode}';` : ''}\n      window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier(\"${\n        invisible ? 'recaptcha-btn' : 'recaptcha-cont'\n      }\", {\n        size: \"${invisible ? 'invisible' : 'normal'}\",\n        callback: onVerify\n      });\n      window.recaptchaVerifier.render();\n    }\n    function onError() {\n      window.ReactNativeWebView.postMessage(JSON.stringify({\n        type: 'error'\n      }));\n    }\n    function onClickButton() {\n      if (!fullChallengeTimer) {\n        fullChallengeTimer = setInterval(function() {\n          var iframes = document.getElementsByTagName(\"iframe\");\n          var isFullChallenge = false;\n          for (i = 0; i < iframes.length; i++) {\n            var parentWindow = iframes[i].parentNode ? iframes[i].parentNode.parentNode : undefined;\n            var isHidden = parentWindow && parentWindow.style.opacity == 0;\n            isFullChallenge = isFullChallenge || (\n              !isHidden && \n              ((iframes[i].title === 'recaptcha challenge') ||\n               (iframes[i].src.indexOf('google.com/recaptcha/api2/bframe') >= 0)));\n          }\n          if (isFullChallenge) {\n            clearInterval(fullChallengeTimer);\n            fullChallengeTimer = undefined;\n            window.ReactNativeWebView.postMessage(JSON.stringify({\n              type: 'fullChallenge'\n            }));  \n          }\n        }, 100);\n      }\n    }\n    window.addEventListener('message', function(event) {\n      if (event.data.verify) {\n        document.getElementById('recaptcha-btn').click();\n      }\n    });\n  </script>\n  <script src=\"https://www.google.com/recaptcha/api.js?onload=onLoad&render=explicit&hl=${\n    languageCode ?? ''\n  }\" onerror=\"onError()\"></script>\n</body></html>`,\n  };\n}\n\nfunction validateFirebaseConfig(firebaseConfig?: FirebaseOptions) {\n  if (!firebaseConfig) {\n    throw new CodedError(\n      'ERR_FIREBASE_RECAPTCHA_CONFIG',\n      `Missing firebase web configuration. Please set the \"expo.web.config.firebase\" field in \"app.json\" or use the \"firebaseConfig\" prop.`\n    );\n  }\n  const { authDomain } = firebaseConfig;\n  if (!authDomain) {\n    throw new CodedError(\n      'ERR_FIREBASE_RECAPTCHA_CONFIG',\n      `Missing \"authDomain\" in firebase web configuration.`\n    );\n  }\n}\n\nexport default function FirebaseRecaptcha(props: Props) {\n  const {\n    firebaseConfig,\n    firebaseVersion,\n    appVerificationDisabledForTesting,\n    languageCode,\n    onVerify,\n    onLoad,\n    onError,\n    onFullChallenge,\n    invisible,\n    verify,\n    ...otherProps\n  } = props;\n  const webview = React.useRef(null);\n  const [loaded, setLoaded] = React.useState(false);\n  React.useEffect(() => {\n    if (webview.current && loaded && verify) {\n      // @ts-ignore: Object is possibly null\n      webview.current.injectJavaScript(`\n    (function(){\n      window.dispatchEvent(new MessageEvent('message', {data: { verify: true }}));\n    })();\n    true;\n    `);\n    }\n    return () => {};\n  }, [webview, verify, loaded]);\n  validateFirebaseConfig(firebaseConfig);\n  if (!firebaseConfig) {\n    console.error(\n      `FirebaseRecaptcha: Missing firebase web configuration. Please set the \"expo.web.config.firebase\" field in \"app.json\" or use the \"firebaseConfig\" prop.`\n    );\n    return null;\n  }\n  return (\n    <WebView\n      ref={webview}\n      javaScriptEnabled\n      automaticallyAdjustContentInsets\n      scalesPageToFit\n      mixedContentMode=\"always\"\n      source={getWebviewSource(\n        firebaseConfig,\n        firebaseVersion,\n        appVerificationDisabledForTesting,\n        languageCode,\n        invisible\n      )}\n      onError={onError}\n      onMessage={(event) => {\n        const data = JSON.parse(event.nativeEvent.data);\n        switch (data.type) {\n          case 'load':\n            if (onLoad) {\n              setLoaded(true);\n              onLoad();\n            }\n            break;\n          case 'error':\n            if (onError) {\n              onError();\n            }\n            break;\n          case 'verify':\n            onVerify(data.token);\n            break;\n          case 'fullChallenge':\n            if (onFullChallenge) {\n              onFullChallenge();\n            }\n            break;\n        }\n      }}\n      {...otherProps}\n    />\n  );\n}\n\nFirebaseRecaptcha.defaultProps = {\n  firebaseConfig: DEFAULT_WEB_APP_OPTIONS,\n};\n"]},"metadata":{},"sourceType":"module"}